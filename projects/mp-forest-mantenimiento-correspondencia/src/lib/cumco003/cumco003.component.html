<div class="ui-fluid">
  <p-tabView>
    <p-toast position="top-center"></p-toast>
    <p-toast position="center" key="c" (onClose)="onReject()" [modal]="true" [baseZIndex]="5000">
      <ng-template let-message pTemplate="message">
        <div style="text-align: center">
          <i class="pi pi-exclamation-triangle" style="font-size: 3em"></i>
          <h3>{{message.summary}}</h3>
          <p>{{message.detail}}</p>
        </div>
        <div class="p-grid ui-fluid">
          <div class="p-col-6">
            <button type="button" pButton (click)="onConfirm()" label="Yes" class="ui-button-success"></button>
          </div>
          <div class="p-col-6">
            <button type="button" pButton (click)="onReject()" label="No" class="ui-button-secondary"></button>
          </div>
        </div>
      </ng-template>
    </p-toast>
    <p-tabPanel header="{{ 'CUMCO003.pestana1' | translate }}">

      <p-fieldset legend="{{ 'CUMCO003.titulo' | translate }}">

        <p>{{ 'CUMCO003.FILTROS.filtroPlantilla' | translate }}</p>

        <div class="ui-g">
          <div class="ui-g-12">
            <div class="ui-inputgroup">
              <span class="ui-inputgroup-addon"><i class="pi pi-search" style="line-height: 1;"></i></span>
              <p-autoComplete [(ngModel)]="seleccionPlantilla" field="codigo" [suggestions]="listaPlantilla" (completeMethod)="searchPlantilla($event)" [dropdown]="true" [forceSelection]="true"
                placeholder="{{ 'CUMCO003.FILTROS.filtroPlantillaPlaceHolder' | translate }}"></p-autoComplete>
              <p-button icon="pi pi-times" (click)="onClicBorrarAutoCompletePlantilla()"></p-button>
            </div>
          </div>
        </div>

        <p>{{ 'CUMCO003.TipoRadicado' | translate }}</p>

        <div class="ui-g">
          <div class="ui-g-12">
            <div class="ui-inputgroup">
              <span class="ui-inputgroup-addon"><i class="pi pi-search" style="line-height: 1;"></i></span>
              <p-autoComplete [(ngModel)]="seleccionRadicado" field="codigoDescripcion" [suggestions]="listaRadicado" (completeMethod)="searchRadicado($event)" [dropdown]="true" [forceSelection]="true"
                placeholder="{{ 'CUMCO003.FILTROS.filtroTipoRadicadoPlaceHolder' | translate }}"></p-autoComplete>
              <p-button icon="pi pi-times" (click)="onClicBorrarAutoCompleteRadicado()"></p-button>
            </div>
          </div>
        </div>

        <p>{{ 'CUMCO003.FILTROS.filtroClaseDocumental' | translate }}</p>

        <div class="ui-g">
          <div class="ui-g-12">
            <div class="ui-inputgroup">
              <span class="ui-inputgroup-addon"><i class="pi pi-search" style="line-height: 1;"></i></span>
              <p-autoComplete [(ngModel)]="seleccionClaseDocumental" field="codigoDescripcion" [suggestions]="listaClaseDocumental" (completeMethod)="searchClaseDocumento($event)" [dropdown]="true" [forceSelection]="true"
                placeholder="{{ 'CUMCO003.FILTROS.filtroClaseDocumentalPlaceHolder' | translate }}"></p-autoComplete>
              <p-button icon="pi pi-times" (click)="onClicBorrarAutoCompleteDocumento()"></p-button>
            </div>
          </div>
        </div>

        <br>
        <br>

        <p-messages [(value)]="msgs"></p-messages>

        <!-- Start Table -->
        <p-table [columns]="cols" [value]="rows" [paginator]="true" [rows]="10" [rowsPerPageOptions]="[5,10,20]" selectionMode="single" [(selection)]="selectedRows">

          <!-- Table Caption -->
          <ng-template pTemplate="caption">
            <div class="ui-helper-clearfix menu-sup-grid">
              <!-- Buttons -->
              <div class="button-sup-grid">
                <p-button label="{{ 'BOTONESTABLA.agregar' | translate }}" icon="pi pi-plus" iconPos="left" style="float:left; margin-left: 2px;" (click)="onClicAgregar()"></p-button>
                <p-button label="{{ 'BOTONESTABLA.eliminar' | translate }}" icon="pi pi-minus" iconPos="left" style="float:left; margin-left: 2px;" (click)="onClicEliminar()"></p-button>
                <p-button label="{{ 'BOTONESTABLA.guardar' | translate }}" icon="pi pi-save" iconPos="left" style="float:left; margin-left: 2px;" (click)="onClicGuardar()"></p-button>
              </div>
            </div>
          </ng-template>

          <!-- Table Heardes -->
          <ng-template pTemplate="header" let-columns>
            <tr>
              <th *ngFor="let col of columns" [pSortableColumn]="col.field">
                {{col.header}}
                <p-sortIcon [field]="col.field" ariaLabel="Activate to sort" ariaLabelDesc="Activate to sort in descending order" ariaLabelAsc="Activate to sort in ascending order"></p-sortIcon>
              </th>
            </tr>
          </ng-template>

          <!-- Table Content -->
          <ng-template pTemplate="body" let-row let-rowData let-columns="columns" let-rowIndex="rowIndex">
            <tr [pSelectableRow]="row" [pSelectableRowIndex]="rowIndex" [ngStyle]="gteRowColorState(row)" *ngIf="(seleccionPlantilla === undefined || seleccionPlantilla.id === row.plantilla.id)
            && (seleccionRadicado === undefined || seleccionRadicado.id === row.tipoRadicado.id)
            && (seleccionClaseDocumental === undefined || seleccionClaseDocumental.id === row.claseDocumental.id)
            || (row.state === 'new')">
              <td pEditableColumn *ngFor="let col of columns; let i = index" [attr.data-index]="i">

                <div [ngSwitch]="i">
                  <div *ngSwitchCase="0"> {{rowIndex + 1}}</div>
                  <div *ngSwitchCase="1">
                    <p-cellEditor>
                      <ng-template pTemplate="input">
                        <p-autoComplete [(ngModel)]="row.plantilla" field="codigo" [suggestions]="listaPlantilla" (onSelect)="edited(rowIndex)" (completeMethod)="searchPlantilla($event)" (click)="onClickElminiarSelected()"
                          [dropdown]="true" [forceSelection]="true" [disabled]="row.state === 'delete'"></p-autoComplete>
                      </ng-template>
                      <ng-template pTemplate="output">
                        {{row.plantilla.codigo}}
                      </ng-template>
                    </p-cellEditor>
                  </div>
                  <div *ngSwitchCase="2">
                    <p-cellEditor>
                      <ng-template pTemplate="input">
                        <p-autoComplete [(ngModel)]="row.tipoRadicado" field="codigoDescripcion" [suggestions]="listaRadicado" (onSelect)="edited(rowIndex)" (completeMethod)="searchRadicado($event)"
                          (click)="onClickElminiarSelected()" [dropdown]="true" [forceSelection]="true" [disabled]="row.state === 'delete'"></p-autoComplete>
                      </ng-template>
                      <ng-template pTemplate="output">
                        {{row.tipoRadicado.codigoDescripcion}}
                      </ng-template>
                    </p-cellEditor>
                  </div>
                  <div *ngSwitchCase="3">
                    <p-cellEditor>
                      <ng-template pTemplate="input">
                        <p-autoComplete [(ngModel)]="row.tramiteTipoRadicado" field="descripcion" [suggestions]="listaSubTipoRadicado" (onSelect)="edited(rowIndex)" (completeMethod)="searchSubTipoRadicado($event, rowIndex)"
                          (click)="onClickElminiarSelected()" [dropdown]="true" [forceSelection]="true" [disabled]="row.state === 'delete'"></p-autoComplete>
                      </ng-template>
                      <ng-template pTemplate="output">
                        {{row.tramiteTipoRadicado.descripcion}}
                      </ng-template>
                    </p-cellEditor>
                  </div>
                  <div *ngSwitchCase="4">
                    <p-cellEditor>
                      <ng-template pTemplate="input">
                        <p-autoComplete [(ngModel)]="row.tipoDocumental" field="codigoDescripcion" [suggestions]="listadoDocumento" (onSelect)="edited(rowIndex)" (completeMethod)="searchDocumento($event)"
                          (click)="onClickElminiarSelected()" [dropdown]="true" [forceSelection]="true" [disabled]="row.state === 'delete'"></p-autoComplete>
                      </ng-template>
                      <ng-template pTemplate="output">
                        {{row.tipoDocumental.codigoDescripcion}}
                      </ng-template>
                    </p-cellEditor>
                  </div>
                  <div *ngSwitchCase="5">
                    <p-cellEditor>
                      <ng-template pTemplate="input">
                        <p-autoComplete [(ngModel)]="row.claseDocumental" field="codigoDescripcion" (click)="onClickElminiarSelected()" [suggestions]="listaClaseDocumental" (completeMethod)="searchClaseDocumento($event)" [dropdown]="true" [forceSelection]="true"
                        ></p-autoComplete>

                        <!-- <p-dropdown [options]="listaClaseDocumental" optionLabel="codigoDescripcion" [(ngModel)]="row.claseDocumental" [disabled]="row.state === 'delete'" (onChange)="validacionEntrada(rowIndex)" (click)="onClickElminiarSelected()"> </p-dropdown> -->

                      </ng-template>
                      <ng-template pTemplate="output">
                        {{row.claseDocumental.codigoDescripcion}}
                      </ng-template>
                    </p-cellEditor>
                  </div>
                  <div *ngSwitchCase="6" style="text-align: center">
                    <p-checkbox name="groupname" [(ngModel)]="row.terminoRequerimiento" [binary]="true" (onChange)="edited(rowIndex)" [disabled]="row.state === 'delete' || row.prorrogaEntidad === 1 || row.prorrogaPeticionario === 1"
                      (ngModelChange)="row.terminoRequerimiento = $event ? 1 : 0"></p-checkbox>
                  </div>
                  <div *ngSwitchCase="7">
                    <p-cellEditor>
                      <ng-template pTemplate="input">
                        <input type="number" [(ngModel)]="row.diasRequerimiento" [disabled]="row.state === 'delete' || row.terminoRequerimiento === 0" (focusout)="edited(rowIndex)" (keydown.enter)="edited(rowIndex)" [maxlength]="3" min="0">
                      </ng-template>
                      <ng-template pTemplate="output">
                        {{row.diasRequerimiento}}
                      </ng-template>
                    </p-cellEditor>
                  </div>
                  <div *ngSwitchCase="8" style="text-align: center">
                    <p-checkbox name="groupname" [(ngModel)]="row.prorrogaEntidad" [binary]="true" (onChange)="edited(rowIndex)" [disabled]="row.state === 'delete' || row.prorrogaPeticionario === 1 || row.terminoRequerimiento === 1"
                      (ngModelChange)="row.prorrogaEntidad = $event ? 1 : 0"></p-checkbox>
                  </div>
                  <div *ngSwitchCase="9" style="text-align: center">
                    <p-checkbox name="groupname" [(ngModel)]="row.prorrogaPeticionario" [binary]="true" (onChange)="edited(rowIndex)" [disabled]="row.state === 'delete' || row.terminoRequerimiento === 1 || row.prorrogaEntidad === 1"
                      (ngModelChange)="row.prorrogaPeticionario = $event ? 1 : 0"></p-checkbox>
                  </div>
                  <div *ngSwitchCase="10">
                    <p-cellEditor>
                      <ng-template pTemplate="input">
                        <input type="number" [(ngModel)]="row.diasProrroga" [disabled]="row.state === 'delete' || (row.prorrogaEntidad === 0 && row.prorrogaPeticionario === 0)" (focusout)="edited(rowIndex)" (keydown.enter)="edited(rowIndex)"
                          (click)="onClickElminiarSelected()" [maxlength]="3" min="0">
                      </ng-template>
                      <ng-template pTemplate="output">
                        {{row.diasProrroga}}
                      </ng-template>
                    </p-cellEditor>
                  </div>
                  <div *ngSwitchCase="11">
                    <p-cellEditor>
                      <ng-template pTemplate="input">
                        <p-dropdown [options]="tablaDocumentos" optionLabel="codigoDescripcion" [(ngModel)]="row.tipoComunicacion" [disabled]="row.state === 'delete'" (onChange)="edited(rowIndex)" (click)="onClickElminiarSelected()"></p-dropdown>
                      </ng-template>
                      <ng-template pTemplate="output">
                        {{row.tipoComunicacion.codigoDescripcion}}
                      </ng-template>
                    </p-cellEditor>
                  </div>
                </div>

              </td>
            </tr>
          </ng-template>

        </p-table>
        <!-- End Table -->

      </p-fieldset>


    </p-tabPanel>

    <p-tabPanel header="{{ 'CUMCO003.pestana2' | translate }}">

      <!-- Start Table -->
      <p-table [columns]="cols2" [value]="tablaDocumentos" [paginator]="true" [rows]="10" [rowsPerPageOptions]="[5,10,20]" selectionMode="single" [(selection)]="selectedRowDocument">

        <!-- Table Caption -->
        <ng-template pTemplate="caption">
          <div class="ui-helper-clearfix menu-sup-grid">
            <!-- Buttons -->
            <div class="button-sup-grid">
              <p-button label="{{ 'BOTONESTABLA.agregar' | translate }}" icon="pi pi-plus" iconPos="left" style="float:left; margin-left: 2px;" (click)="onClicAgregarComunicacion()"></p-button>
              <p-button label="{{ 'BOTONESTABLA.eliminar' | translate }}" icon="pi pi-minus" iconPos="left" style="float:left; margin-left: 2px;" (click)="onClicEliminarComunicacion()"></p-button>
              <p-button label="{{ 'BOTONESTABLA.guardar' | translate }}" icon="pi pi-save" iconPos="left" style="float:left; margin-left: 2px;" (click)="onClicGuardarComuniacion()"></p-button>
            </div>
          </div>
        </ng-template>

        <!-- Table Heardes -->
        <ng-template pTemplate="header" let-columns>
          <tr>
            <th *ngFor="let col of columns" [pSortableColumn]="col.field">
              {{col.header}}
              <p-sortIcon [field]="col.field" ariaLabel="Activate to sort" ariaLabelDesc="Activate to sort in descending order" ariaLabelAsc="Activate to sort in ascending order"></p-sortIcon>
            </th>
          </tr>
        </ng-template>

        <!-- Table Content -->
        <ng-template pTemplate="body" let-row let-rowData let-columns="columns" let-rowIndex="rowIndex">
          <tr [pSelectableRow]="row" [pSelectableRowIndex]="rowIndex" [ngStyle]="gteRowColorState(row)">
            <!-- *ngIf="(filtroTipoIdentificacion === undefined || filtroTipoIdentificacion.id === row.id)"> -->
            <td pEditableColumn *ngFor="let col of columns; let i = index" [attr.data-index]="i">

              <div [ngSwitch]="i">
                <div *ngSwitchCase="0">
                  <p-cellEditor>
                    <ng-template pTemplate="input">
                      <input type="number" [(ngModel)]="row.codigo" [disabled]="row.state === 'delete'" (focusout)="editedDocument(rowIndex)" (keydown.enter)="editedDocument(rowIndex)" [maxlength]="3">
                    </ng-template>
                    <ng-template pTemplate="output">
                      {{row.codigo}}
                    </ng-template>
                  </p-cellEditor>
                </div>
                <div *ngSwitchCase="1">
                  <p-cellEditor>
                    <ng-template pTemplate="input">
                      <input type="text" [(ngModel)]="row.descripcion" [disabled]="row.state === 'delete'" (focusout)="editedDocument(rowIndex)" (keydown.enter)="editedDocument(rowIndex)" [maxlength]="100">
                    </ng-template>
                    <ng-template pTemplate="output">
                      {{row.descripcion}}
                    </ng-template>
                  </p-cellEditor>
                </div>
                <div *ngSwitchCase="2">
                  <p-cellEditor>
                    <ng-template pTemplate="input">
                      <p-dropdown [options]="listaClaseDocumental" optionLabel="descripcion" [(ngModel)]="row.claseDocumental" [disabled]="row.state === 'delete'" (onChange)="editedDocument(rowIndex)" (click)="onClickElminiarSelected2()">
                      </p-dropdown>
                    </ng-template>
                    <ng-template pTemplate="output">
                      {{row.claseDocumental.descripcion}}
                    </ng-template>
                  </p-cellEditor>
                </div>
              </div>

            </td>
          </tr>
        </ng-template>

      </p-table>
      <!-- End Table -->

    </p-tabPanel>

  </p-tabView>
</div>
